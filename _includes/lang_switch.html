<div class="lang-switch">
  <a class="lang-btn" id="lang-jp" href="#">JP</a>
  <a class="lang-btn" id="lang-en" href="#">EN</a>
</div>

<script>

(function () {
  const path = window.location.pathname;
  const isEn = path === "/en/" || path.startsWith("/en/");

  // ナビタイトル → 英語表記 & ENパス
  const navMap = {
    "About":      { enText: "About",      enPath: "/en/about/" },
    "Members":    { enText: "Members",    enPath: "/en/member/" },
    "Member":     { enText: "Members",    enPath: "/en/member/" },
    "News":       { enText: "News",       enPath: "/en/news/" },
    "Research":   { enText: "Research",   enPath: "/en/research/" },
    "Contact":    { enText: "Contact",    enPath: "/en/contact/" },
    "Contact Us": { enText: "Contact",    enPath: "/en/contact/" }
  };

  document.querySelectorAll(".site-nav .page-link").forEach(a => {
    const text = a.textContent.trim();
    const conf = navMap[text];
    if (!conf) return;

    if (isEn) {
      a.textContent = conf.enText;
      a.setAttribute("href", conf.enPath);
    } else {
      // JP 側：/en を外す
      const href = a.getAttribute("href");
      if (href.startsWith("/en/")) {
        a.setAttribute("href", href.replace(/^\/en/, ""));
      }
    }
  });
})();

(function () {
  const path = window.location.pathname;

  let jpPath, enPath;

  if (path === "/en/" || path.startsWith("/en/")) {
    // EN → JP
    enPath = path;
    jpPath = path.replace(/^\/en/, "") || "/";
    document.getElementById("lang-en").classList.add("active");
  } else {
    // JP → EN
    jpPath = path;
    enPath = "/en" + (path === "/" ? "/" : path);
    document.getElementById("lang-jp").classList.add("active");
  }

  document.getElementById("lang-jp").href = jpPath;
  document.getElementById("lang-en").href = enPath;
})();

// ここからメインページの見出し書き換え
console.log("[i18n] running on", location.pathname);

setTimeout(() => {
  const isEnNow = location.pathname === "/en/" || location.pathname.startsWith("/en/");
  if (!isEnNow) return;

  const dict = {
    "latest-news": "Latest News",
    "recent-research": "Recent Research Topics"
  };

  document.querySelectorAll("[data-i18n]").forEach(el => {
    const key = el.dataset.i18n;
    if (dict[key]) el.textContent = dict[key];
  });

  console.log("[i18n] headings updated");
}, 0);

// 左上のサイトタイトル（ページトップ）リンクを言語に合わせる
try {
  const isEnNow = location.pathname === "/en/" || location.pathname.startsWith("/en/");
  const siteTitle = document.querySelector("a.site-title");
  if (siteTitle) {
    siteTitle.setAttribute("href", isEnNow ? "/en/" : "/");
  }
  if (siteTitle && isEnNow) {
   siteTitle.textContent = "Shoji Lab (Shizuoka Univ.)"; // 好きな表記に
  }
} catch (e) {
  console.warn("[i18n] site-title link skipped:", e);
}

</script>